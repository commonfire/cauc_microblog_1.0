<%@ page language="java" import="java.util.*" pageEncoding="UTF-8" trimDirectiveWhitespaces="true"%>
<%@include file="/WEB-INF/pages/common/taglib.jsp"%>
<!DOCTYPE html>
<html>
	<head>	
		<!-- start: Meta -->
		<meta charset="utf-8">
		<title>民航安保信息管理分析预警平台</title>
		<meta name="description" content="Bootstrap Metro Dashboard">
		<meta name="author" content="wangjie">
		<meta name="keyword" content="Metro, Metro UI, Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
		<!-- end: Meta -->	
		<%@include file="/WEB-INF/pages/common/common.jsp" %>
		
		<style type="text/css">
		
		</style>
		<script type="text/javascript" src="${basePath}/resources/sg/tz_page.js"></script>								
	</head>	
	<body>
		<%@include file="/WEB-INF/pages/common/header.jsp" %>		

		<div class="container-fluid-full">
			<div class="row-fluid">				
				<%@include file="/WEB-INF/pages/common/left.jsp" %>
				
				<noscript>
					<div class="alert alert-block span10">
						<h4 class="alert-heading">Warning!</h4>
						<p>You need to have <a href="http://en.wikipedia.org/wiki/JavaScript" target="_blank">JavaScript</a> enabled to use this site.</p>
					</div>
				</noscript>
								
				<!-- start: Content -->
				<div id="content" class="span10">
					<ul class="breadcrumb">
						<li>
							<i class="icon-home"></i>
							<a href="index.html">Home</a> 
							<i class="icon-angle-right"></i>
						</li>
						<li><a href="#">Tables</a></li>
					</ul>
					<div class="row-fluid sortable">		
						<div class="box span12">
							<div class="box-header" data-original-title>
								<h2><i class="halflings-icon user"></i><span class="break"></span>Members</h2>
								<div class="box-icon">
									<a href="#" class="btn-setting"><i class="halflings-icon wrench"></i></a>
									<a href="#" class="btn-minimize"><i class="halflings-icon chevron-up"></i></a>
									<a href="#" class="btn-close"><i class="halflings-icon remove"></i></a>
								</div>
							</div>
							<div class="box-content">
								<table class="table table-striped table-bordered">
								  <thead>
									  <tr>
										  <th>Username</th>
										  <th>Date registered</th>
										  <th>Role</th>
										  <th>Status</th>
										  <th>Actions</th>
									  </tr>
								  </thead>   
								  <tbody>
									<tr>
										<td>Dennis Ji</td>
										<td class="center">2012/01/01</td>
										<td class="center">Member</td>
										<td class="center">
											<span class="label label-success">Active</span>
										</td>
										<td class="center">
											<a class="btn btn-success" href="#">
												<i class="halflings-icon white zoom-in"></i>  
											</a>
											<a class="btn btn-info" href="#">
												<i class="halflings-icon white edit"></i>  
											</a>
											<a class="btn btn-danger" href="#">
												<i class="halflings-icon white trash"></i> 
											</a>
										</td>
									</tr>
									<tr>
										<td>Dennis Ji</td>
										<td class="center">2012/01/01</td>
										<td class="center">Member</td>
										<td class="center">
											<span class="label label-success">Active</span>
										</td>
										<td class="center">
											<a class="btn btn-success" href="#">
												<i class="halflings-icon white zoom-in"></i>  
											</a>
											<a class="btn btn-info" href="#">
												<i class="halflings-icon white edit"></i>  
											</a>
											<a class="btn btn-danger" href="#">
												<i class="halflings-icon white trash"></i> 
											</a>
										</td>
									</tr>
									<tr>
										<td>Dennis Ji</td>
										<td class="center">2012/01/01</td>
										<td class="center">Member</td>
										<td class="center">
											<span class="label label-success">Active</span>
										</td>
										<td class="center">
											<a class="btn btn-success" href="#">
												<i class="halflings-icon white zoom-in"></i>  
											</a>
											<a class="btn btn-info" href="#">
												<i class="halflings-icon white edit"></i>  
											</a>
											<a class="btn btn-danger" href="#">
												<i class="halflings-icon white trash"></i> 
											</a>
										</td>
									</tr>
									<tr>
										<td>Dennis Ji</td>
										<td class="center">2012/01/01</td>
										<td class="center">Member</td>
										<td class="center">
											<span class="label label-success">Active</span>
										</td>
										<td class="center">
											<a class="btn btn-success" href="#">
												<i class="halflings-icon white zoom-in"></i>  
											</a>
											<a class="btn btn-info" href="#">
												<i class="halflings-icon white edit"></i>  
											</a>
											<a class="btn btn-danger" href="#">
												<i class="halflings-icon white trash"></i> 
											</a>
										</td>
									</tr>
									<tr>
										<td>Dennis Ji</td>
										<td class="center">2012/01/01</td>
										<td class="center">Member</td>
										<td class="center">
											<span class="label label-success">Active</span>
										</td>
										<td class="center">
											<a class="btn btn-success" href="#">
												<i class="halflings-icon white zoom-in"></i>  
											</a>
											<a class="btn btn-info" href="#">
												<i class="halflings-icon white edit"></i>  
											</a>
											<a class="btn btn-danger" href="#">
												<i class="halflings-icon white trash"></i> 
											</a>
										</td>
									</tr>
									<tr>
										<td>Dennis Ji</td>
										<td class="center">2012/01/01</td>
										<td class="center">Member</td>
										<td class="center">
											<span class="label label-success">Active</span>
										</td>
										<td class="center">
											<a class="btn btn-success" href="#">
												<i class="halflings-icon white zoom-in"></i>  
											</a>
											<a class="btn btn-info" href="#">
												<i class="halflings-icon white edit"></i>  
											</a>
											<a class="btn btn-danger" href="#">
												<i class="halflings-icon white trash"></i> 
											</a>
										</td>
									</tr>
									<tr>
										<td>Dennis Ji</td>
										<td class="center">2012/01/01</td>
										<td class="center">Member</td>
										<td class="center">
											<span class="label label-success">Active</span>
										</td>
										<td class="center">
											<a class="btn btn-success" href="#">
												<i class="halflings-icon white zoom-in"></i>  
											</a>
											<a class="btn btn-info" href="#">
												<i class="halflings-icon white edit"></i>  
											</a>
											<a class="btn btn-danger" href="#">
												<i class="halflings-icon white trash"></i> 
											</a>
										</td>
									</tr>
									<tr>
										<td>Dennis Ji</td>
										<td class="center">2012/01/01</td>
										<td class="center">Member</td>
										<td class="center">
											<span class="label label-success">Active</span>
										</td>
										<td class="center">
											<a class="btn btn-success" href="#">
												<i class="halflings-icon white zoom-in"></i>  
											</a>
											<a class="btn btn-info" href="#">
												<i class="halflings-icon white edit"></i>  
											</a>
											<a class="btn btn-danger" href="#">
												<i class="halflings-icon white trash"></i> 
											</a>
										</td>
									</tr>
									<tr>
										<td>Dennis Ji</td>
										<td class="center">2012/01/01</td>
										<td class="center">Member</td>
										<td class="center">
											<span class="label label-success">Active</span>
										</td>
										<td class="center">
											<a class="btn btn-success" href="#">
												<i class="halflings-icon white zoom-in"></i>  
											</a>
											<a class="btn btn-info" href="#">
												<i class="halflings-icon white edit"></i>  
											</a>
											<a class="btn btn-danger" href="#">
												<i class="halflings-icon white trash"></i> 
											</a>
										</td>
									</tr>
									<tr>
										<td>Dennis Ji</td>
										<td class="center">2012/01/01</td>
										<td class="center">Member</td>
										<td class="center">
											<span class="label label-success">Active</span>
										</td>
										<td class="center">
											<a class="btn btn-success" href="#">
												<i class="halflings-icon white zoom-in"></i>  
											</a>
											<a class="btn btn-info" href="#">
												<i class="halflings-icon white edit"></i>  
											</a>
											<a class="btn btn-danger" href="#">
												<i class="halflings-icon white trash"></i> 
											</a>
										</td>
									</tr>
									<tr>
										<td>Dennis Ji</td>
										<td class="center">2012/01/01</td>
										<td class="center">Member</td>
										<td class="center">
											<span class="label label-success">Active</span>
										</td>
										<td class="center">
											<a class="btn btn-success" href="#">
												<i class="halflings-icon white zoom-in"></i>  
											</a>
											<a class="btn btn-info" href="#">
												<i class="halflings-icon white edit"></i>  
											</a>
											<a class="btn btn-danger" href="#">
												<i class="halflings-icon white trash"></i> 
											</a>
										</td>
									</tr>
									<tr>
										<td>Dennis Ji</td>
										<td class="center">2012/01/01</td>
										<td class="center">Member</td>
										<td class="center">
											<span class="label label-success">Active</span>
										</td>
										<td class="center">
											<a class="btn btn-success" href="#">
												<i class="halflings-icon white zoom-in"></i>  
											</a>
											<a class="btn btn-info" href="#">
												<i class="halflings-icon white edit"></i>  
											</a>
											<a class="btn btn-danger" href="#">
												<i class="halflings-icon white trash"></i> 
											</a>
										</td>
									</tr>
									<tr>
										<td>Dennis Ji</td>
										<td class="center">2012/01/01</td>
										<td class="center">Member</td>
										<td class="center">
											<span class="label label-success">Active</span>
										</td>
										<td class="center">
											<a class="btn btn-success" href="#">
												<i class="halflings-icon white zoom-in"></i>  
											</a>
											<a class="btn btn-info" href="#">
												<i class="halflings-icon white edit"></i>  
											</a>
											<a class="btn btn-danger" href="#">
												<i class="halflings-icon white trash"></i> 
											</a>
										</td>
									</tr>
										<td>Dennis Ji</td>
										<td class="center">2012/01/01</td>
										<td class="center">Member</td>
										<td class="center">
											<span class="label label-success">Active</span>
										</td>
										<td class="center">
											<a class="btn btn-success" href="#">
												<i class="halflings-icon white zoom-in"></i>  
											</a>
											<a class="btn btn-info" href="#">
												<i class="halflings-icon white edit"></i>  
											</a>
											<a class="btn btn-danger" href="#">
												<i class="halflings-icon white trash"></i> 
											</a>
										</td>
									</tr>
								  </tbody>
							  </table> 
							  <div class="cpage" style="display:block;"></div>							             
							</div>
						</div><!--/span-->				
					</div><!--/row-->	
	  			</div>	
				<!-- end: Content -->
			</div><!--/#content.span10-->
		</div><!--/fluid-row-->
		
		<div class="modal hide fade" id="myModal">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">×</button>
				<h3>Settings</h3>
			</div>
			<div class="modal-body">
				<p>Here settings can be configured...</p>
			</div>
			<div class="modal-footer">
				<a href="#" class="btn" data-dismiss="modal">Close</a>
				<a href="#" class="btn btn-primary">Save changes</a>
			</div>
		</div>
		
		<div class="clearfix"></div>
		
		<%@include file="/WEB-INF/pages/common/footer.jsp" %>	
	

		<script type="text/javascript">
			
			$(function(){
				tzAdmin.loadData(0,10,function(itemCount){
					tzAdmin.initPage(itemCount);//分页加载一次吗
				});
				
			});
			$(function(){
				$(".tmui-tips").tmTip();
			});

			function loading2(target,mark){
				$.loading({target:$(target),mark:1}); 
			};

			var tzAdmin = {
				timer :null,
				ltimer :null,
				initPage:function(itemCount){
					$(".cpage").tzPage(itemCount, {
						num_edge_entries : 1, //边缘页数
						num_display_entries :4, //主体页数
						num_edge_entries:5,
						current_page:0,
						showGo:true,
						showSelect:true,
						items_per_page : 10, //每页显示X项
						prev_text : "前一页",
						next_text : "后一页",
						callback : function(pageNo,psize){//回调函数
							tzAdmin.loadData(pageNo,psize);
						}
					});
				},
				loadData:function(pageNo,pageSize,callback){
					var keyword = $("#keywords").val();
					var model = $("#tbody").data("model");
					var $this = this;
					clearTimeout(this.ltimer);
					this.ltimer = setTimeout(function(){
						$.ajax({
							type:"post",
							beforeSend:function(){loading2($("#tbody"),4);},
							url:adminPath+"/"+model+"/template",
							data:{pageNo:pageNo*pageSize,pageSize:pageSize,keyword:keyword},
							success:function(data){
								var $data = $(data);
								$("#tbody").html($data);//追加元素到dom中
								$(".tmui-tips").tmTip();
								var itemCount = $data.find("#itemCount").val();
								if(isNotEmpty(keyword))$this.highligter(keyword);
								if(callback)callback(itemCount);
							}
						});
					},300);
				},
				highligter:function(key){
					if(isEmpty(key))return;
					$("#tbody").find(".keys").each(function(){
						var text = $(this).text();
						//var nt = text.replace(key,"<span class='red'>"+key+"</span>");
						//var nt = text.replace(key,"<span class='red'>"+key+"</span>");
						var regex = new RegExp(key,"ig");
						var nt = text.replace(regex,"<span class='red'>"+key+"</span>");
						$(this).html(nt);
					});
				},
				search:function(){
//					var keyword = $("#keywords").val();
//						if(isEmpty(keyword)){
//							loading("请输入关键字...",3);
//							$("#keywords").focus();
//							return;
//						}
					tzAdmin.loadData(0,10,function(itemCount){
						tzAdmin.initPage(itemCount);//分页加载一次吗
					});
				},
				op:function(obj){
					var $this = $(obj);
					var opid = $this.attr("opid");
					var mark = $this.attr("mark");
					var val = $this.attr("val");
					var model = $("#tbody").data("model");
					var params = {};
					params[mark] = val;
					params["id"] = opid;
					//alert(JSON.stringify(params));
					clearTimeout(this.timer);
					this.timer = setTimeout(function(){
						loading("请稍后数据执行中...");
						$.ajax({
							type:"post",
							url:adminPath+"/"+model+"/update",
							data:params,
							success:function(data){
								loading("执行成功...",3);
								if(data=="success"){
									$this.attr({opid:opid,val:val==0?1:0}).removeClass().addClass(val==0?"red":"green").text(val==0?"否":"是");
								}
							}
						});
					},200); 
				},
				remove:function(obj){
					$.tzConfirm({title:"友情提示",content:"您确定删除吗?",callback:function(ok){
						if(ok){
							var $this = $(obj);
							var opid = $this.data("opid");
							var model = $("#tbody").data("model");
							clearTimeout(this.timer);
							var params = {};
							params["id"] = opid;
							this.timer = setTimeout(function(){
								loading("请稍后数据执行中...");
								$.ajax({
									type:"post",
									url:adminPath+"/"+model+"/delete",
									data:params,
									success:function(data){
										loading("执行成功...",3);
										$this.parents("tr").remove();
										var len = $("#tbody").find("tr").length;
										if(len==0){
											//window.location.href =window.location.href;
											tzAdmin.loadData(0,10,function(itemCount){
												tzAdmin.initPage(itemCount);//分页加载一次吗
											});
										}
									}
								});
							},200); 
						}
					}});
				}
			};
		</script>

	</body>
</html>
	